<div class="step-text">
<p></p><h5 id="description">Description</h5><p>This stage aims to enable the assistant to fetch and handle JSON data from a stock market API. This involves integrating prompt engineering skills to create effective queries for the assistant, ensuring accurate data retrieval from the stock API. The API you need to use is <a href="https://www.alphavantage.co/documentation/" rel="noopener noreferrer nofollow" target="_blank">Alpha Vantage</a>. Check the link to see how it's used. </p><h5 id="objectives">Objectives</h5><p>Your task is to add the assistant the ability to fetch stock data and display it. Here's a step-by-step guide to achieve this:</p><p><strong>1. Set up the stock API:</strong> Use the API key to retrieve stock data. For example, retrieve the daily time series data for the stock symbol 'AAPL'.  The function parameter can be one of the following: "TIME_SERIES_INTRADAY", "TIME_SERIES_DAILY",<br/>"TIME_SERIES_WEEKLY", "TIME_SERIES_MONTHLY".<br/>The symbol parameter is the stock symbol of your choice. This regular Python function can send a request to the stock API URL. The assistant will use this function and pass the necessary arguments.</p><p><strong>2. Define the tools:</strong> Next define a <code class="java">tools</code> list and pass it to the <code class="java">assistants.create()</code>. You can see an example <a href="https://platform.openai.com/docs/assistants/tools/defining-functions" rel="noopener noreferrer nofollow" target="_blank">here</a>. The function you define here, should match the Python function from the previous step. This means that the parameters defined here in the <code class="java">tools</code> are the parameters for the Python function. This is how GPT understands how to use the function.</p><p><strong>3. Trigger the action with a prompt:</strong> You can try with different prompts however; in this case, run this prompt to trigger the function calling:</p><pre><code class="language-no-highlight">"Retrieve and show the latest daily time series data for the stock symbol 'AAPL'."</code></pre><p><strong>4. Handle the requires_action state:</strong> After triggering the function calling, the run object will enter a <code class="java">requires_action</code> <a href="https://platform.openai.com/docs/assistants/tools/reading-the-functions-called-by-the-assistant" rel="noopener noreferrer nofollow" target="_blank">state</a>. This is where you execute the Python function to call the stock API. To execute the function, you need to use the function name, arguments, and function ID.  You can find them in <a href="https://platform.openai.com/docs/api-reference/runs/submitToolOutputs" rel="noopener noreferrer nofollow" target="_blank">submit_tool_outputs</a>. Print the tool_call IDs with each function call.</p><div class="alert alert-warning"><p>The assistant may call the function <a href="https://platform.openai.com/docs/guides/function-calling/parallel-function-calling" rel="noopener noreferrer nofollow" target="_blank">multiple times</a>, in that case you need to handle it with a loop.</p></div><p><strong>5. Submit function response:</strong> Once the function has been executed, <a href="https://platform.openai.com/docs/assistants/tools/submitting-functions-outputs" rel="noopener noreferrer nofollow" target="_blank">return its output</a> to the assistant. Following this, the assistant will proceed with the conversation, integrating the response from the function.</p><p>You can print the assistant's responses at the end.</p><h5 id="examples">Examples</h5><p><strong>Example 1: Retrieving stock data with function calling</strong></p><pre><code class="language-no-highlight">Matching `stock_analyzer_assistant` assistant found, using the first matching assistant with ID: asst_iahCFboNCzF7i25pj3yYVjfa
Thread created with ID: thread_A4PKceRZrEUDLdw2F6t87ILY
Run initiated with ID: run_LyCPPQ7Q8QjA0uifQdmysZ1w
Waiting for response from `stock_analyzer_assistant` Assistant. Elapsed time: 4.92 seconds
Tool call with ID and name:  call_zFlM1aqjtfkqsNgszl4ruHeG retrieve_stock_data
Done! Response received in 6.25 seconds.

Run initiated with ID: run_LyCPPQ7Q8QjA0uifQdmysZ1w
Assistant response: Here is the latest daily time series data for the stock symbol 'AAPL':

- Date: 2024-03-07
  - Open: $169.1500
  - High: $170.7300
  - Low: $168.4900
  - Close: $169.0000
- Volume: 71,765,061

This data is as of the most recent update.</code></pre><p>Ensure that your program outputs all necessary information, including the creation of the assistant, the Thread, and the Run instance, following the specified formats for IDs and messages.</p>
</div>